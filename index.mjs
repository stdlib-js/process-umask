// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.1.1-esm/index.mjs";import{isPrimitive as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.1.0-esm/index.mjs";import{isPrimitive as t}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@v0.1.1-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.1.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.1.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/string-left-pad@v0.1.1-esm/index.mjs";var l={0:"rwx",1:"rw",2:"rx",3:"r",4:"wx",5:"w",6:"x",7:""};function a(e){var r;return e=e.toString(8),e=o(e,4,"0"),r="",r+="u="+l[e[1]],r+=",",r+="g="+l[e[2]],r+=",",r+="o="+l[e[3]]}var m=/^(u{0,1}g{0,1}o{0,1}a{0,1}|)([+\-=])(r{0,1}w{0,1}x{0,1})$/,f={r:2,w:1,x:0},g={s:0,u:1,g:2,o:3};function p(e){return 1<<e>>>0}function u(e,r){return(e&~p(r))>>>0}function d(e,r){var t,n,s,l,a,d,h,c,b,v,j,y;for(t=o(e.toString(8),4,"0").split(""),v=0;v<t.length;v++)t[v]=parseInt(t[v],10);for(n=r.split(","),v=0;v<n.length;v++){if(null===(a=n[v].match(m)))return new Error(i('invalid argument. Unable to parse mask expression. Ensure the expression is properly formatted, only uses the class letters "u", "g", "o", and "a", only uses the operators "+", "-", and "=", and only uses the permission symbols "r", "w", and "x". Value: `%s`.',r));if(""===(l=a[1]))l="ugo";else{for(c="",y=0;y<l.length;y++)"a"===l[y]?c+="ugo":c+=l[y];l=c}if(h=a[2],s=a[3],"-"===h){if(""===s)continue;for(j=0;j<s.length;j++)for(b=f[s[j]],y=0;y<l.length;y++)t[d=g[l[y]]]=(t[d]|p(b))>>>0}else if("+"===h){if(""===s)continue;for(j=0;j<s.length;j++)for(b=f[s[j]],y=0;y<l.length;y++)t[d=g[l[y]]]=u(t[d],b)}else if(""===s)for(y=0;y<l.length;y++)t[d=g[l[y]]]=7;else{for(y=0;y<l.length;y++)t[d=g[l[y]]]=7;for(j=0;j<s.length;j++)for(b=f[s[j]],y=0;y<l.length;y++)t[d=g[l[y]]]=u(t[d],b)}}for(v=0;v<t.length;v++)t[v]=t[v].toString();return parseInt(t.join(""),8)}function h(){var o,l,m,f,g;if(0===(l=arguments.length))return 0;if(f={},g=arguments[0],1===l){if(e(g)){if((m=d(0,g))instanceof Error)throw m;return 0}if(r(g))return 0;if(n(g)){if(s(g,"symbolic")&&(f.symbolic=g.symbolic,!t(f.symbolic)))throw new TypeError(i("invalid option. `%s` option must be a boolean. Option: `%s`.","symbolic",f.symbolic));return m=0,f.symbolic&&(m=a(m)),m}throw new TypeError(i("invalid argument. Must provide either a string, nonnegative integer, or an options object. Value: `%s`.",g))}if(!n(o=arguments[1]))throw new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",o));if(s(o,"symbolic")&&(f.symbolic=o.symbolic,!t(f.symbolic)))throw new TypeError(i("invalid option. `%s` option must be a boolean. Option: `%s`.","symbolic",f.symbolic));if(e(g)){if((m=d(0,g))instanceof Error)throw m}else{if(!r(g))throw new TypeError(i("invalid argument. First argument must be either a string or nonnegative integer. Value: `%s`.",g));m=g}return m=0,f.symbolic&&(m=a(m)),m}export{h as default};
//# sourceMappingURL=index.mjs.map
